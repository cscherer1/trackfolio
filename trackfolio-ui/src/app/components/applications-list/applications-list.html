<section class="max-w-6xl mx-auto p-4">
  <header class="flex items-center justify-between mb-4">
    <h1 class="text-2xl font-bold">Applications</h1>

    <div class="flex gap-2">
      <button (click)="load()"
              class="rounded border border-gray-300 px-3 py-2">Refresh</button>
      <a routerLink="/applications/new"
         class="rounded border border-gray-300 px-3 py-2">Add application</a>
    </div>
  </header>

  <div *ngIf="loading" class="rounded border p-4">Loading…</div>

  <div *ngIf="!loading && error" class="rounded border p-4 bg-red-50 text-red-700">
    {{ error }}
  </div>

  <div *ngIf="!loading && !error && apps.length === 0" class="rounded border p-4">
    No applications yet. Click <strong>Add application</strong> to create your first one.
  </div>

  <div *ngIf="!loading && !error && apps.length > 0"
       class="overflow-x-auto border rounded">
    <table class="min-w-full">
      <thead>
      <tr class="bg-gray-100">
        <th class="text-left p-2">Company</th>
        <th class="text-left p-2">Role</th>
        <th class="text-left p-2">Status</th>
        <th class="text-left p-2">Source</th>
        <th class="text-left p-2">Applied</th>
        <th class="text-left p-2">Location</th>
        <th class="text-left p-2">Link</th>
        <th class="text-left p-2">Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let a of apps" class="border-t">
        <td class="p-2">{{ a.company }}</td>
        <td class="p-2">{{ a.roleTitle }}</td>
        <td class="p-2">{{ a.status }}</td>
        <td class="p-2">{{ a.source }}</td>
        <td class="p-2">{{ a.appliedAt | date:'yyyy-MM-dd' }}</td>
        <td class="p-2">{{ a.location || '—' }}</td>
        <td class="p-2">
          <a *ngIf="a.jobLink" [href]="a.jobLink" target="_blank" rel="noopener"
             class="underline">Open</a>
          <span *ngIf="!a.jobLink">—</span>
        </td>
        <td class="p-2 flex gap-2">
          <a [routerLink]="['/applications', a.id, 'edit']"
             class="rounded border border-gray-300 px-3 py-2">Edit</a>

          <button *ngIf="deletingId !== a.id"
                  (click)="remove(a.id!)"
                  class="rounded border border-gray-300 px-3 py-2">Delete</button>

          <button *ngIf="deletingId === a.id"
                  disabled
                  class="rounded border border-gray-300 px-3 py-2 opacity-60">
            Deleting…
          </button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</section>
